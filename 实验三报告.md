

| 实验名称     | Android界面组件实验 |
| -------- | ------------- |
| **学生姓名** | 肖朝闻           |
| **学号**   | 121052023118  |
| **班级**   | 软工4班          |
| **专业**   | 软件工程          |
| **实验日期** | 2025年11月11日   |

## 一、 实验目的

掌握 Android 界面组件相关功能，具体包括：

1. **ListView 与 Adapter：** 掌握使用 `SimpleAdapter` 实现自定义列表项布局（包含文本和图像），并处理列表项的点击事件（`Toast` 和 `Notification`）。

2. **AlertDialog：** 掌握使用 `AlertDialog.Builder.setView()` 加载自定义 XML 布局，实现复杂的登录对话框。

3. **XML 菜单：** 掌握使用 XML 文件定义选项菜单（Options Menu）和子菜单，并通过 Java 代码处理菜单项的点击事件来动态修改界面元素（如字体大小和颜色）。

4. **ActionMode：** 掌握 `ListView` 的多选模式 (`multipleChoiceModal`)，实现上下文操作模式（Contextual Action Mode），并动态更新选中项数量。

## 二、 实验环境与工具

- **操作系统：** Windows 11

- **开发工具：** Android Studio

- **编程语言：** Java 

## 三、 实验步骤与流程

### 3.1 预备步骤：主题修复与权限声明

由于 Action Bar 和菜单是本次实验的关键，首先修正主题配置，并声明必要的权限：

1. **修复主题（`res/values/themes.xml`）：** 将应用主题从 `Theme.Material3.DayNight.NoActionBar` 修改为 **`Theme.Material3.DayNight`**，以启用 Action Bar，确保选项菜单和上下文操作模式能正常显示。

2. **声明通知权限（`AndroidManifest.xml`）：** 为了在实验一中发送通知，声明 Android 13+ 所需的运行时权限：`<uses-permission android:name="android.permission.POST_NOTIFICATIONS" />`。
   
   ### 3.2 实验一：使用 SimpleAdapter 的 ListView
   
   | **文件**                 | **内容**                                                                                                                                                                          |
   | ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | `list_item_layout.xml` | 定义列表项布局：包含一个 `ImageView` (`@id/animal_image`) 和一个 `TextView` (`@id/animal_name`)。                                                                                               |
   | `MainActivity.java`    | 1. 准备 `List<Map<String, Object>>` 数据源（动物名称和图片资源ID）。2. 使用 `SimpleAdapter` 将数据源与布局进行绑定。3. 在 `onItemClick` 中实现 **Toast 提示** 和 **发送通知** 的逻辑，并在发送通知前添加 `POST_NOTIFICATIONS` 权限检查和请求。 |
   
   ### 3.3 实验二：自定义布局的 AlertDialog
   
   | **文件**                     | **内容**                                                                                                                                                                                                 |
   | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | `dialog_login.xml`         | 设计登录对话框布局：包含一个带背景色的标题 `TextView`、两个 `EditText`（用户名和密码）、以及两个 `Button`（Cancel 和 Sign in）。                                                                                                                |
   | `AlertDialogActivity.java` | 1. 获取 `LayoutInflater`。2. 使用 `inflater.inflate(R.layout.dialog_login, null)` 加载自定义布局。3. 通过 `AlertDialog.Builder.setView(dialogView)` 将布局设置给对话框。4. 为布局中的 Sign in 和 Cancel 按钮添加点击事件，实现关闭对话框和 Toast 提示功能。 |
   
   ### 3.4 实验三：使用 XML 定义菜单
   
   | **文件**                   | **内容**                                                                                                                                                                                                                          |
   | ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | `main_menu.xml`          | 在 `res/menu` 下定义菜单结构，包含三个顶级项：**字体大小**（子菜单，含小、中、大）、**字体颜色**（子菜单，含红、黑）、**普通菜单项**。                                                                                                                                                 |
   | `activity_menu_test.xml` | 修正布局：为了避免 `TextView` 被 Action Bar 遮挡，在 `TextView` 上添加属性：`android:layout_marginTop="?attr/actionBarSize"`。                                                                                                                       |
   | `MenuTestActivity.java`  | 1. 重写 `onCreateOptionsMenu()`，使用 `getMenuInflater().inflate()` 加载 `main_menu.xml`。2. 重写 `onOptionsItemSelected()`，使用 `if-else if` 结构（解决 `Constant expression required` 错误）来处理菜单点击事件，动态修改 `TextView` 的 `textSize` 和 `textColor`。 |
   
   ### 3.5 实验四：创建上下文操作模式 (ActionMode)
   
   | **文件**                     | **内容**                                                                                                                                                                                                                                                                                                        |
   | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | `context_menu.xml`         | 定义上下文菜单，包含一个带有垃圾桶图标的 `action_delete` 菜单项。                                                                                                                                                                                                                                                                     |
   | `activity_action_mode.xml` | **修正布局：** 解决 `ListView` 遮挡问题，在根 `LinearLayout` 上添加 `android:paddingTop="?attr/actionBarSize"`。设置 `ListView` 属性：`android:choiceMode="multipleChoiceModal"`。                                                                                                                                                    |
   | `ActionModeActivity.java`  | 1. 为 `ListView` 设置 `ArrayAdapter` 绑定数据。2. 调用 `listView.setMultiChoiceModeListener()` 实现 `AbsListView.MultiChoiceModeListener` 接口。3. 在 `onItemCheckedStateChanged` 方法中，使用 `mode.setTitle(checkedCount + " selected")` 实现动态显示选中数量的功能。4. 在 `onActionItemClicked` 中，仅关闭 `ActionMode` (`mode.finish()`)，不执行实际删除操作。 |

## 四、 实验结果与分析

### 4.1 运行截图

    4.1.1  实验1
    ![](C:\Users\Lenovo\AppData\Roaming\marktext\images\2025-11-17-20-58-34-image.png)
    
    4.1.2 实验二
    ![](C:\Users\Lenovo\AppData\Roaming\marktext\images\2025-11-17-20-59-28-image.png)
    

    ![](C:\Users\Lenovo\AppData\Roaming\marktext\images\2025-11-17-21-00-09-image.png)

    使用账户名为eee 密码为1234登录后：
    ![](C:\Users\Lenovo\AppData\Roaming\marktext\images\2025-11-17-21-00-59-image.png)



4.1.3 实验三（仅展示红色大号字体）

    ![](C:\Users\Lenovo\AppData\Roaming\marktext\images\2025-11-17-21-01-49-image.png)



4.1.4 实验四

长按第一行One后

![](C:\Users\Lenovo\AppData\Roaming\marktext\images\2025-11-17-21-02-33-image.png)

    

###### 4.2 结果分析

| **问题类型**     | **现象描述**                                                                                           | **解决方案及原理**                                                                                                                                      |
| ------------ | -------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| **主题配置问题**   | 实验三/四中，顶部的 Action Bar 和菜单（⋮）不显示。                                                                   | **问题：** `themes.xml` 中继承了 `NoActionBar` 主题。**解决：** 将主题更改为标准主题（如 `Theme.Material3.DayNight`），使系统自动绘制 Action Bar。                                  |
| **布局遮挡问题**   | 实验三/四中，`TextView` 或 `ListView` 的首行内容被 Action Bar 遮挡。                                               | **问题：** 布局从屏幕最顶部开始绘制。**解决：** 给根布局（或被遮挡的视图）添加 `android:paddingTop="?attr/actionBarSize"`，动态获取 Action Bar 高度，实现内容避让。                               |
| **菜单 ID 报错** | 实验三 `onOptionsItemSelected` 中，使用 `switch (item.getItemId())` 导致 `Constant expression required` 报错。 | **问题：** 在某些配置下，资源 ID (`R.id.xxx`) 无法被编译器识别为编译时常量。**解决：** 将 `switch-case` 结构替换为更灵活的 `if-else if` 结构。                                              |
| **通知权限报错**   | 实验一在 Android 13+ 上发送通知时程序崩溃。                                                                       | **问题：** Android 13+ 需要运行时权限 `POST_NOTIFICATIONS`。**解决：** 在 `AndroidManifest.xml` 中声明权限，并在 Java 代码中通过 `requestPermissionLauncher` 机制进行运行时权限检查和请求。 |



## 五、 总结与心得体会

深刻理解了 Android Activity 与其主题（Theme）之间的关系，认识到主题配置对 UI 元素（如 Action Bar）显示的重要性。

熟练掌握了 `ListView` 的基本使用和 `SimpleAdapter` 的自定义列表项绑定机制。

掌握了在 Java 中处理平台版本差异的方法，特别是针对 Android 13 的 `POST_NOTIFICATIONS` 运行时权限处理。

通过 `?attr/actionBarSize` 的使用，掌握了处理 Action Bar 动态高度的方法，避免了界面组件间的重叠冲突。

- 成功实现了选项菜单和上下文操作模式这两种重要的用户交互模式。
